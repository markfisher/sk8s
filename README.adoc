= riff is for functions image:https://ci.projectriff.io/api/v1/teams/main/pipelines/riff/badge[Riff Pipeline, link=https://ci.projectriff.io/teams/main/pipelines/riff]

image::logo.png[riff logo]

A FaaS for Kubernetes

== Installation of latest release

You can install the latest (0.0.4) release using link:Getting-Started.adoc[a Helm chart].

The https://github.com/projectriff/riff/tree/v0.0.4/samples[0.0.4 samples] will work together
with the https://github.com/projectriff/riff/releases[0.0.4 CLI].

Samples on the git master branch of this repo have been updated to work with recently modified
invokers and can be deployed using the new go CLI. See below for build instructions.

== Developer installation

To use Helm to install the current development version (git master branch) of riff, see link:Development-Helm-install.adoc[Installing the riff development version using Helm].

=== [[manual]] Manual install of riff

This is the best option if you want to modify the riff components.

==== Prerequisites

You need:

* A running 1.7+ Kubernetes cluster. These instructions assume minikube for now.

[source,bash]
----
minikube start
----

* Git installed.

* A Java 8 environment.

* A working Go environment with dep

==== Clone the go components

[source, bash]
----
go get -d github.com/projectriff/function-sidecar/...
go get -d github.com/projectriff/function-controller/...
go get -d github.com/projectriff/topic-controller/...
go get -d github.com/projectriff/http-gateway/...
go get -d github.com/projectriff/shell-function-invoker/...
go get -d github.com/projectriff/riff-cli/...
----

==== Clone riff and the other (non-golang) repos

NOTE: These repos should be cloned under a unique root directory since we will be using relative paths during the build.

[source, bash]
----
#cd <some_root_dir>
git clone https://github.com/projectriff/riff.git
git clone https://github.com/projectriff/java-function-invoker.git
git clone https://github.com/projectriff/node-function-invoker.git
git clone https://github.com/projectriff/python2-function-invoker.git
----

From now on, this README assumes you're running commands from the `riff` repository clone:

[source, bash]
----
cd riff
----

==== Point your local Docker environment to the Docker environment running in minikube

[source, bash]
----
eval $(minikube docker-env)
----

==== Build the riff core components, invokers and CLI

[source, bash]
----
./build-function-sidecar
./build-http-gateway
./build-topic-controller
./build-function-controller
./build-riff-cli
./build-shell-function-invoker
./build-java-function-invoker 
./build-node-function-invoker
./build-python2-function-invoker
----

==== Add the compiled riff CLI to your path or alias it.

[source, bash]
----
alias riff="$(go env GOPATH)/src/github.com/projectriff/riff-cli/riff"
----

==== Deploy Kafka/Zookeeper

[source, bash]
----
kubectl apply -f config/kafka
----

==== Deploy the riff custom resources

This creates the Function and Topic CRDs (Custom Resource Definitions):

[source, bash]
----
kubectl apply -f config/types
----

==== Deploy the riff core components

This deploys the HTTP Gateway, Topic Controller, and Function Controller:

[source, bash]
----
kubectl apply -f config
----

If your cluster has RBAC enabled, then you also need to create a Role and a RoleBinding:

[source, bash]
----
kubectl apply -f config/rbac
----

==== To tear it all down

Once you're done playing with riff (see samples below), you can destroy everything created above by running

[source, bash]
----
./teardown
----

== [[samples]]Try Some Samples

With riff running try some of the link:samples/README.adoc[samples].

== Contributing to riff

Please refer to the link:CONTRIBUTING.adoc[Contributors' Guide].

== Maintaining riff

Please refer to the link:MAINTAINING.adoc[Maintainers' Guide].
